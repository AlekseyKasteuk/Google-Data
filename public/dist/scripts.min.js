var app=angular.module("GoogleData",["ui.router","ui.tinymce","ngMaterial","ngMessages","ngFileUpload","ngImgCrop"]);app.config(["$httpProvider","$urlRouterProvider","$stateProvider","$locationProvider","$mdIconProvider","$mdThemingProvider",function(e,t,a,o,r,n){t.otherwise("/"),a.state("login",{url:"/login",templateUrl:"application/states/login/login.html",controller:"LoginCtrl"}).state("app",{url:"/",templateUrl:"application/states/app/app.html",controller:"AppCtrl"}).state("app.profile",{url:"profile?account",templateUrl:"application/states/app/profile/profile.html",controller:"ProfileCtrl"}).state("app.messages",{url:"messages?labels",templateUrl:"application/states/app/messages/messages.html",controller:"MessageCtrl"}),n.theme("default").primaryPalette("blue").accentPalette("indigo")}]),app.run(["$rootScope","$state","$stateParams","authService",function(e,t,a,o){e.getRange=function(e,t){return console.log(e,t),t=t?t:{},"birth year"==e?_.range(moment().year(),moment().year()-120):"birth month"==e?moment.months():"birth date"==e&&t.year&&t.month?_.range(1,moment().year(t.year).month(t.month).daysInMonth()+1):[]},e.$on("$stateChangeStart",function(a,r,n){o.checkAuth().success(function(a){e.authorizedUser=a,console.log(a),"login"==r.name&&t.go("app")}).error(function(){e.authorizedUser=void 0,"login"!=r.name&&t.go("login")})})}]);
app.factory("authService",["$http",function(t){return{login:function(n){return t.post("/login",n)},logout:function(){return t.post("/logout")},checkAuth:function(){return t.get("/auth/check")},createNewAccount:function(n){return t.post("/create/account",n)}}}]);
app.factory("messageService",["$http",function(e){return{getThreads:function(t){return e.post("/google/message/threads",{labels:t})}}}]);
app.factory("profileService",["$http",function(e){return{getProfileInfo:function(o){return e.get("/user/info?profile="+o)},updateCurrentGoogleAccount:function(o){return console.log(o),e.put("/google/update",{id:o})}}}]);
app.factory("socket",["$rootScope",function(n){var o=io.connect();return{on:function(t,c){o.on(t,function(){var t=arguments;n.$apply(function(){c.apply(o,t)})})},emit:function(t,c,p){o.emit(t,c,function(){var t=arguments;n.$apply(function(){p&&p.apply(o,t)})})}}}]);
app.factory("uploadFileService",["Upload",function(o){return function(t,a,l){return console.log(o.dataUrltoBlob(t,l).toString()),o.upload({url:a,method:"POST",data:{message:"HELLO WORLD!"},file:o.dataUrltoBlob(t,l)})}}]);
app.directive("profileCard",["profileService","$timeout","$stateParams",function(e,i,r){return{restrict:"A",scope:{},templateUrl:"/application/directives/profile_card/profile_card.html",link:function(e,t){var a=r.account?r.account:"internal";e.profile={type:a},t.bind("animationend",function(){t.removeClass("rotated-profile-card")}),e.changeProfileType=function(r){t.addClass("rotated-profile-card"),i(function(){e.profile.type=r},500)}}}}]);
app.directive("spinner",function(){return{restrict:"E",scope:{},template:"<div><md-progress-circular md-mode='indeterminate'></md-progress-circular></div>"}});
app.controller("createNewAccountCtrl",["$scope","$mdDialog","authService",function(e,c,n){e.user={},e.hide=function(){c.hide()},e.cancel=function(){c.cancel()},e.answer=function(){n.createNewAccount(e.user).success(function(){c.hide(e.user.first_name+" "+e.user.last_name)}).error(function(){})}}]);
app.controller("ProfileDlgCtrl",["$scope","$mdDialog","uploadFileService","$timeout",function(n,e,i,o){n.close=function(){e.cancel()},n.upload=function(l,c){n.enableSpinner=!0,i(l,"/profile/avatar",c).then(function(){o(function(){n.enableSpinner=!1,e.hide()},1e3)},function(){n.enableSpinner=!1})}}]);
app.controller("AppCtrl",["$scope","socket","$state","authService","$mdDialog",function(t,i,n,e,l){t.logout=function(){e.logout().success(function(){n.go("login")})},i.on("authorization_faild",function(){n.go("login")}),t.tinymceOptions={onChange:function(t){console.log(t)},inline:!1,plugins:["advlist autolink lists link image charmap print preview anchor","searchreplace visualblocks fullscreen media","insertdatetime table contextmenu paste"],toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image",skin:"lightgray",theme:"modern",statusbar:!1,width:450,height:455}}]);
app.controller("LoginCtrl",["$scope","authService","$mdDialog","$state","$mdToast",function(t,e,o,n,c){t.user={},t.login=function(){e.login(t.user).success(function(){n.go("app")}).error(function(t){c.show(c.simple().textContent(t).action("OK").highlightAction(!1).position("top left"))})},t.showAlert=function(t){o.show({controller:"createNewAccountCtrl",templateUrl:"application/modal_dialogs/create_new_account/create_new_account.html",parent:angular.element(document.body),targetEvent:t,clickOutsideToClose:!0,fullscreen:!0}).then(function(t){c.show(c.simple().textContent(t+" was created").action("OK").highlightAction(!1).position("top left"))})}}]);
app.directive("profileCardGoogle",["$mdDialog","$window","profileService",function(e,r,o){return{restrict:"A",scope:!1,templateUrl:"/application/directives/profile_card/google/google.html",link:function(t,n){function c(){o.getProfileInfo("google").success(function(e){console.log(e),t.users=e}).error(function(){})}t.$watch("users",function(){t.users||(t.currentUser={});var e=t.users.filter(function(e){return e.isCurrent});t.currentUser=e.length?e[0]:{},t.$watch("currentUser",function(){o.updateCurrentGoogleAccount(t.currentUser?t.currentUser.id:-1).success(function(e){}).error(function(){})}),console.log(t.currentUser)}),c(),t.addNewGoogleAccount=function(){r.location.href="/google"},t.selectAvatar=function(){e.show({controller:"ProfileDlgCtrl",templateUrl:"application/modal_dialogs/profile/profile_dlg.html",parent:angular.element(document.body),targetEvent:event,clickOutsideToClose:!1,fullscreen:!0,openFrom:angular.element(document.querySelector("#current-user-avatar")),closeTo:angular.element(document.querySelector("#current-user-avatar"))}).then(function(){c()})}}}}]);
app.directive("profileCardInternal",["$mdDialog","profileService",function(e,r){return{restrict:"A",scope:!1,templateUrl:"/application/directives/profile_card/internal/internal.html",link:function(t,n){function l(){r.getProfileInfo("internal").success(function(e){t.user=e}).error(function(){})}l(),t.selectAvatar=function(){e.show({controller:"ProfileDlgCtrl",templateUrl:"application/modal_dialogs/profile/profile_dlg.html",parent:angular.element(document.body),targetEvent:event,clickOutsideToClose:!1,fullscreen:!0,openFrom:angular.element(document.querySelector("#current-user-avatar")),closeTo:angular.element(document.querySelector("#current-user-avatar"))}).then(function(){l()})}}}}]);
app.controller("MessageCtrl",["$scope","$stateParams","messageService",function(e,s,a){var l=s.labels?s.labels.split(","):["INBOX"];a.getThreads(l).success(function(e){console.log(e)})}]);
app.controller("ProfileCtrl",["$scope","profileService","$mdDialog","$window","uploadFileService",function(e,o,i,l,r){}]);